<!doctype html>  
<html lang="en">  
<head>  
  <meta charset="utf-8">  
  <title>CVE Statistics</title>  
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/lux/bootstrap.min.css" rel="stylesheet">  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  
  <style>  
    .chart-container {  
      position: relative;  
      height: 300px;  
    }  
  </style>  
</head>  
<body class="p-4 bg-light">  
  <div class="container">  
    <h1 class="mb-4">CVE Statistics</h1>  
    <a href="/" class="btn btn-secondary mb-4">← Back</a>  
  
    <div id="loader" class="alert alert-info">Ładowanie danych...</div>  
    <div id="error" class="alert alert-danger d-none"></div>  
  
    <div class="row d-none" id="charts">  
      <div class="col-md-6">  
        <div class="chart-container">  
          <canvas id="severityChart"></canvas>  
        </div>  
      </div>  
      <div class="col-md-6">  
        <div class="chart-container">  
          <canvas id="statusChart"></canvas>  
        </div>  
      </div>  
    </div>  
  </div>  
  
  <script>  
    function randomColor() {  
      return `hsl(${Math.random() * 360}, 70%, 50%)`;  
    }  
  
    fetch('/api/cves')  
      .then(res => {  
        if (!res.ok) throw new Error(`HTTP error ${res.status}`);  
        return res.json();  
      })  
      .then(data => {  
        const severityCounts = {};  
        const statusCounts = {};  
  
        data.forEach(c => {  
          severityCounts[c.severity] = (severityCounts[c.severity] || 0) + 1;  
          statusCounts[c.status] = (statusCounts[c.status] || 0) + 1;  
        });  
  
        // Ukrywamy loader, pokazujemy wykresy  
        document.getElementById('loader').classList.add('d-none');  
        document.getElementById('charts').classList.remove('d-none');  
  
        new Chart(document.getElementById('severityChart'), {  
          type: 'pie',  
          data: {  
            labels: Object.keys(severityCounts),  
            datasets: [{  
              data: Object.values(severityCounts),  
              backgroundColor: Object.keys(severityCounts).map(() => randomColor())  
            }]  
          },  
          options: {  
            responsive: true,  
            maintainAspectRatio: false,  
            plugins: { title: { display: true, text: 'Severity Distribution' } }  
          }  
        });  
  
        new Chart(document.getElementById('statusChart'), {  
          type: 'doughnut',  
          data: {  
            labels: Object.keys(statusCounts),  
            datasets: [{  
              data: Object.values(statusCounts),  
              backgroundColor: Object.keys(statusCounts).map(() => randomColor())  
            }]  
          },  
          options: {  
            responsive: true,  
            maintainAspectRatio: false,  
            plugins: { title: { display: true, text: 'Status Distribution' } }  
          }  
        });  
      })  
      .catch(err => {  
        document.getElementById('loader').classList.add('d-none');  
        const errorBox = document.getElementById('error');  
        errorBox.textContent = `Błąd pobierania danych: ${err.message}`;  
        errorBox.classList.remove('d-none');  
        console.error(err);  
      });  
  </script>  
</body>  
</html>  
